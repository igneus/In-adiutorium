##############
# Antifonar: kompletar

file "vystup/antifonar_kompletar.pdf" => ["vystup/antifonar_kompletar.tex"] do
  chdir "vystup"
  sh "pdflatex antifonar_kompletar"
  chdir ".."
end

cislazalmu = [4, 134, 91, 86, 143, 31, 130, 16, 88]

zalmy_syrove = cislazalmu.map {|i| "zalmy/zalm"+i.to_s+".zalm"}
zalmy_pecene = cislazalmu.map {|i| "generovane/zalm"+i.to_s+".tex"}
preprocessor = "../nastroje/psalmpreprocessor.rb"

zalmy_syrove.each_index do |i|
  file zalmy_pecene[i] => [zalmy_syrove[i], preprocessor] do |t|
    chdir "generovane"
    sh "ruby ../../nastroje/psalmpreprocessor.rb --last-accent-only ../#{zalmy_syrove[i]}"
    chdir ".."
  end
end

file "generovane/doxologie.tex" => ["zalmy/doxologie.zalm", preprocessor] do
  chdir "generovane"
  sh "ruby ../../nastroje/psalmpreprocessor.rb --last-accent-only --no-title ../zalmy/doxologie.zalm"
  chdir ".."
end

task :zalmy => (zalmy_pecene << 'doxologie.tex')

file "vystup/antifonar_kompletar.tex" => ["antifonar_kompletar.lytex", "kompletar_1.ly", "doxologie.tex"]+zalmy_pecene do
  sh "lilypond-book --out=vystup --pdf antifonar_kompletar.lytex"
end

file "kompletar_1.ly" => ["../kompletar.ly"] do
  sh "ruby ../nastroje/splitscores.rb ../kompletar.ly"
end

task :default => ["vystup/antifonar_kompletar.pdf"]

###############
# material k responsorialnimu prednesu zalmu 136

file "generovane/zalm136responsorialni.tex" => ["zalmy/zalm136responsorialni.zalm"] do
  chdir "generovane"
  sh "ruby ../../nastroje/psalmpreprocessor.rb --no-formatting ../zalmy/zalm136responsorialni.zalm"
  chdir ".."
end

file "vystup/zalm136.tex" => ["generovane/zalm136responsorialni.tex", "zalm136noty.ly", "spolecne.tex"] do
  sh "lilypond-book --out=vystup --pdf zalm136.lytex"
end

file "vystup/zalm136.pdf" => ["vystup/zalm136.tex"] do
  cd "vystup"
  sh "pdflatex zalm136"
  cd ".."
end
